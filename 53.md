# Дополнительные функции mysqli.

# Получение количества записей, котоыре вернул запрос

В mysqli есть специальная функция, которая может сказать, какое количество строк вернул запрос. 
Традиционно употребляется в двух случаях, когда это 

а) не нужно
б) неправильно

Первый случай - когда мы хотим узнать, вернул ли запрос хоть какие-то данные, или нет.

В этом случае у нас есть сами данные. То есть мы все равно получаем данные из запроса - вот их и можно сначала получить, а потом использовать чтобы узнать, вернул ли запрос что-нибудь.

Второй вариант - если эта функция используется чтобы посчитать, сколько строк лежит в БД. В таком варианте это будет откровенное вредительство, поскольку данных может быть много, и все эти данные БД должна сначала получить у себя, а потом отправить в РНР. Заняв всю доступную память или даже вызвав фатальную ошибку нехватки памяти.  

Правильным вариантом будет сделать запрос вида `SELECT COUNT(*) FROM ...`. В этом случае БД сама внутри себя посчитает количество строк (очень быстро) и вернёт только одно число, которое не занимает оперативную память вообще.

# Получение автоинкрементного идентификатора только что добавленной записи

Если у теблицы есть автоинкрементный уникальный идентификатор, (поле с атрибутами PRIMATY KEY auto_increment), то после вставки новой записи можно получить значение этого поля функцией insert_id.

<?php

Поскольку функций для работы с БД довольно много, следует пройтись по самым важным из них, чтобы было общее представление о том, какие операции они могут выполнять, а так же привести типовые примеры задач, в которых они применяются. 

# Список основных функций mysqli

- **`mysqli_report()`** устанавливает режим информирования об ошибках. Gишется 1 раз перед коннектом в виде `mysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);`
- **`set_charset()`**  устанавливает кодировку соединения, должна всегда вызываться сразу после коннекта в виде `$db->set_charset("utf8mb4")`;
**`insert_id`** - возвращает автоинкрементный идентификатор. В объектном варианте не функция, 
mysqli_fetch_row - иногда нумерованный массив удобнее ассоциативного
mysqli_prepare - подготавливает запрос, если в нем используются переменные
mysqli_stmt_bind_param - привязывает переменные к запросу
mysqli_stmt_execute - выполняет подготовленный запрос
mysqli_stmt_get_result - возвращает результат запроса SELECT выполненного через prepare/execute  для использования функциями mysqli_fetch_*

# Устаревшие и бесполезные функции

Веб-программирование - молодая и стремительно развивающаяся область. И РНР развивается вместе с ней. Как это бывает, некоторые элементы языка и приёмы устаревают или оказываются ненужными. Ниже небольшой список таких функций, которые могут вам встретиться в существующих проектах. Их наличие с большой долей уверенности может говорить о том, что код этих так же устарел.

- **`mysqli_num_rows`** - бесполезная функция, практически никогда не бывает нужна. В нормальных API отсутствует.
mysqli_select_db - устаревшая функция, БД указывается в параметрах 
mysqli_real_escape_string - принесла неисчислимый вред в силу того, что многие поколения РНР программистов верили что эта функция предназначена для защиты от SQL инъекций. В то время как это не так, а для защиты служат подготовленные выражения.
mysqli_connect_error - устаревшая функция, вместо неё следует использовать mysqli_report
mysqli_error - устаревшая функция, вместо неё следует использовать mysqli_report
